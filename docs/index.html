<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CSV Table and Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
    <style>
        body {
          display: flex;
          flex-direction: row;
          font-family: sans-serif;
          justify-content: center; /* Center content horizontally */
          align-items: flex-start; /* Align content to the top */
          min-height: 100vh; /* Ensure body takes full viewport height */
          margin: 0; /* Remove default body margin */
        }

        /* Styles for the selection screen */
        #selectionScreen {
            display: flex; /* Initially visible */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh; /* Take full viewport height */
            width: 100vw; /* Take full viewport width */
            position: fixed; /* Overlay on top */
            top: 0;
            left: 0;
            background-color: white; /* Or any background you prefer */
            z-index: 1000; /* Ensure it's on top of everything */
        }

        #selectionScreen h1 {
            margin-bottom: 30px;
        }

        #selectionScreen button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #selectionScreen button:hover {
            background-color: #0056b3;
        }

        /* Default hidden state for the content containers */
        #leftContainer, #rightContainer {
            display: none; /* Initially hidden */
            width: 50%;
            padding: 0 20px; /* Adjust if you prefer different spacing */
            box-sizing: border-box;
        }

        /* Styles for when content is visible */
        .show-both #leftContainer,
        .show-both #rightContainer {
            display: block; /* Show both */
        }

        .show-electoral #leftContainer {
            display: block; /* Show only electoral */
            width: 100%; /* Make it full width */
        }

        .show-independence #rightContainer {
            display: block; /* Show only independence */
            width: 100%; /* Make it full width */
        }

        /* Existing styles below (with potential refinements) */
        table {
          border-collapse: collapse;
          width: 100%;
          margin-top: 20px;
        }
        th, td {
          border: 1px solid #aaa;
          padding: 8px;
          text-align: left;
        }
        th {
          background-color: #eee;
        }
        canvas {
          max-width: 100%;
          margin-top: 30px;
          height: auto;
        }
        #lineExplanations p {
          font-size: 0.95em;
          margin-top: 8px;
        }
    </style>
</head>
<body>

<div id="selectionScreen">
    <h1>Select Data View</h1>
    <button id="viewBoth">View Both Data Sets</button>
    <button id="viewElectoral">View Only Electoral Data</button>
    <button id="viewIndependence">View Only Independence Data</button>
</div>

<div id="leftContainer">
    <h2 id="pieTitle">Pie Chart</h2>
    <canvas id="pieChart"></canvas>

    <h2>Line Graph of All Data</h2>
    <p id="scaling_warn">
        Note data is not time-scaled.
    </p>
    <canvas id="lineChart"></canvas>

    <p id="explanationIntro">
        Much like in real life, descriptions of left and right wing aren't perfect dichotomies. In Richardian politics, there is a dual scale of left and right. The first is socially left or right. This very much like in real life, with left reflecting more liberal thought, and right reflecting more conservative beliefs. The other scale is the academic left or right. This describes the party's approach to academics, the dominant concern in Richardian politics. Academically left-leaning parties tend to prefer a holistic approach, increasing rest, friendships, and extracurricular in the hope that they will indirectly improve academic performance (think "cutting taxes" or "social spending" as a real-life analogue). Academically right-leaning parties believe that the only solution to academic problems is simply confronting them with more hard work (think "hard-on-crime" as a real-life analogue). Much like in real life, many parties don't lean the same direction on both spectrums.
    </p>
    <div id="lineExplanations"></div>

    <h1>CSV Output Table</h1>
    <table id="csvTable"></table>
</div>

<div id="rightContainer">
    <h2 id="pieTitleRight">Pie Chart (OutputPar)</h2>
    <canvas id="pieChartRight"></canvas>

    <h2>Line Graph of OutputPar Data</h2>
    <canvas id="lineChartRight"></canvas>

    <h1>OutputPar Table</h1>
    <table id="csvTableRight"></table>
</div>

<script>
    const customColors = [
        '#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231',
        '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe'
    ];
</script>

<script id="electoralScript">
    // Your existing electoral data (output.csv) script content goes here
    // IMPORTANT: Make sure this script only runs when electoral data is needed
    // We will modify how this script is loaded/executed in JS
</script>

<script id="independenceScript">
    // Your existing independence data (docs/outputPar.csv) script content goes here
    // IMPORTANT: Make sure this script only runs when independence data is needed
    // We will modify how this script is loaded/executed in JS
</script>

<script>
    // NEW JAVASCRIPT FOR BUTTON LOGIC
    const selectionScreen = document.getElementById('selectionScreen');
    const viewBothBtn = document.getElementById('viewBoth');
    const viewElectoralBtn = document.getElementById('viewElectoral');
    const viewIndependenceBtn = document.getElementById('viewIndependence');
    const body = document.body; // Reference to the body element for class manipulation

    // Function to load and execute a script's content
    function loadScriptContent(scriptId, fetchFunction) {
        const scriptElement = document.getElementById(scriptId);
        if (scriptElement) {
            // Remove existing content to prevent re-execution if already loaded
            scriptElement.innerHTML = '';
            // Call the original fetch function directly
            fetchFunction();
        }
    }

    // --- Define your fetch functions here, wrapping your existing script content ---

    // Electoral Data Fetch Function
    function fetchElectoralData() {
        fetch("output.csv")
            .then(response => response.text())
            .then(data => {
                const rows = data.trim().split("\n").map(row => row.split(",").filter(cell => cell.trim() !== ""));
                const headers = rows[0].map(header => header.trim());
                const table = document.getElementById("csvTable");

                // Clear previous content in case of re-render
                table.innerHTML = '';

                // Create table headers
                const thead = table.createTHead();
                const headerRow = thead.insertRow();
                headers.forEach(header => {
                    const th = document.createElement("th");
                    th.textContent = header;
                    headerRow.appendChild(th);
                });

                // Create table body
                const tbody = table.createTBody();
                for (let i = 1; i < rows.length; i++) {
                    const row = tbody.insertRow();
                    rows[i].forEach(cell => {
                        const td = row.insertCell();
                        td.textContent = cell;
                    });
                }

                // Line chart data
                const lineLabels = rows.slice(1).map(row => row[0]);
                const datasets = headers.map((header, colIndex) => {
                    if (colIndex === 0) return null;
                    const color = customColors[(colIndex - 1) % customColors.length];
                    return {
                        label: header,
                        data: rows.slice(1).map(row => parseFloat(row[colIndex])),
                        borderColor: color,
                        backgroundColor: color + '33', // transparent fill
                        fill: 'origin',
                        tension: 0.3, // Set to 0 for no smoothing if desired
                        borderWidth: 2
                    };
                }).filter(Boolean);

                const lineCtx = document.getElementById("lineChart").getContext("2d");
                // Destroy previous chart instance if it exists to prevent overlap
                if (window.electoralLineChart) {
                    window.electoralLineChart.destroy();
                }
                window.electoralLineChart = new Chart(lineCtx, {
                    type: "line",
                    data: {
                        labels: lineLabels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index', // Changed from 'nearest' for general multi-dataset tooltip
                            intersect: false
                        },
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                        },
                        scales: {
                            x: {
                                type: 'category', // Using category scale as it's "not time-scaled"
                                title: {
                                    display: true,
                                    text: 'Date' // Label remains 'Date'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Votes'
                                }
                            }
                        }
                    }
                });

                // Pie chart from last row
                const lastRow = rows[rows.length - 1];
                const mostRecentDate = lastRow[0];
                document.getElementById("pieTitle").textContent =
                    `${mostRecentDate}'s Election Results`;

                const pieLabels = headers.slice(1);
                const pieData = lastRow.slice(1).map(v => parseFloat(v));
                const pieCtx = document.getElementById("pieChart").getContext("2d");

                // Destroy previous chart instance
                if (window.electoralPieChart) {
                    window.electoralPieChart.destroy();
                }
                window.electoralPieChart = new Chart(pieCtx, {
                    type: "pie",
                    data: {
                        labels: pieLabels,
                        datasets: [{
                            data: pieData,
                            backgroundColor: customColors.slice(0, pieLabels.length)
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });

                // Explanations
                const explanationContainer = document.getElementById("lineExplanations");
                explanationContainer.innerHTML = ''; // Clear previous explanations
                const explanations = {
                    "SA": "(Socialist Alliance) (Academically Far-Left, Socially Left) A historical socialist/communist party that was the inspiration for the RLP. It fell because it was too idealistic, something the RLP rectified. Led the First Academic Revolution in eighth grade.",
                    "MCP": "(Moderate-Centre Party) (Academically Left, Socially Left) The big-tent left-wing/centrist party, similar to the modern democratic party. Originally founded as a newer broad centrist alternative to the LEP back when it was a socially leftist party, now it has totally supplanted the LEP in its former role and shifted leftward socially. Main advocate for rest and other indirect measures to promote academic performance in addition to the YPP and sometimes the LEP.",
                    "LEP": "(Liberty-Equality Party) (Academically Left, Socially Right [Formerly Left]) Before the rise of the RLP, the LEP was the dominant party in early high school. The old LEP stood for liberal ideals, combined with liberal academic approaches. However, in the run-up to college, a series of debacles caused by its lax academic stance caused it to loose much popularity, with its former little sister the MCP taking much its former influence in the liberal sphere. Afterwards, the LEP has reinvented itself as a stalwartly socially conservative (right-wign) party promoting \"properity\", hanging on left-wing academic policies. The modern LEP enjoys electoral successes usually under conditions of demobilization after an academic semester.",
                    "MU": "(Musical Union) (Nonpartisan) As the domestic musical industry faced attacks and potential decline in high school under growing academic pressure, it felt that no party was willing to represent its interests. Thus, the MU was born as a splinter faction of the AU. The Musical Union represents the Richardian interest in piano/composing at a given time. It is nonpartisan and works with any parties willing to secure music in the budget.",
                    "AU": "(Academic Union) (Academically Center-Right, Socially Right) Originally a direct competitor to the RLP with almost the exact same platform (albeit taking even less of a social position), the AU was beset by internal infighting and faded in obscurity. As of late it has seen a resurgence in popularity as many realize the republic lacks an alternative to the dying RLP conservative hegenomy, with the AU becoming a more academically purist alternative to the RLP.",
                    "NAP": "(Nationalist Alliance Party) (Academically Far-Right, Socially Far-Right) Similar to the SA, a historical far-right party that exists during the early unstable stages of Richardian democracy that is no longer extant. Advocated sharp nationalistic academic change, ultra-conservative social ideology (something lost to later parties) and strengthening of the executive branch to effect that.",
                    "RLP": "(Reform Labour Party) (Academically Right, Socially Center-Right) The dominant party since the fall of the LEP, it has recently seen struggles for influence. The RLP was born out of popular dissatification with the policies of the SA and a desire for a more syncretist approach to economics, combining right-wing \"grit\" with left-wing optimism and planning. The resulting RLP swept to power in the Second Academic Revolution in the sophomore year of high school. The RLP holds light conservative social views, believing that academics is most of their platform. The RLP is the academic party; other parties are often the exception to the RLP rule.",
                    "CDoP": "(Crown Dominion Party) (Academically Right) Represents parental influence in the Richardian republic, as our constitutional structure still grants significant powers to parents as a Dominion of a broader Empire. The CDoP nominally doesn't hold \"petty\" positions on domestic politics, but typically acts academically and socially conservative. Most left-wing parties hold somewhat of a disdain for the CDoP.",
                    "YPP": "(Youth Power Party) (Academically Left, Socially Left) Represents the youth and liberal academics. This party has a particularly energetic spirit, focusing on friendships, love, and \"responsible\" light academics as its primary platform. Particularly with new friends or partners, or academic booms that allow the pursuit of more relaxed component policies, the YPP rules. It has no problem with collaborating with the MCP, as their views and goals usually align.",
                };

                datasets.forEach(ds => {
                    const p = document.createElement("p");
                    p.innerHTML = `<strong>${ds.label}:</strong> ${explanations[ds.label] || "No description available."}`;
                    explanationContainer.appendChild(p);
                });
            });
    }

    // Independence Data Fetch Function
    function fetchIndependenceData() {
        fetch("outputPar.csv")
            .then(res => res.text())
            .then(data => {
                const rows = data.trim().split("\n").map(row => row.split(",").filter(cell => cell.trim() !== ""));
                const headers = rows[0].map(h => h.trim());

                // Build table
                const table = document.getElementById("csvTableRight");
                // Clear previous content
                table.innerHTML = '';
                const thead = table.createTHead();
                const headerRow = thead.insertRow();
                headers.forEach(header => {
                    const th = document.createElement("th");
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                const tbody = table.createTBody();
                for (let i = 1; i < rows.length; i++) {
                    const row = tbody.insertRow();
                    rows[i].forEach(cell => {
                        const td = row.insertCell();
                        td.textContent = cell;
                    });
                }

                // Line chart (time-scaled)
                const lineLabels = rows.slice(1).map(row => row[0]); // Dates
                const datasets = headers.slice(1).map((header, i) => ({
                    label: header,
                    data: rows.slice(1).map(row => ({ x: row[0], y: parseFloat(row[i + 1]) })),
                    borderColor: customColors[i % customColors.length],
                    fill: false,
                    tension: 0.3 // Set to 0 for no smoothing if desired
                }));

                const ctxLine = document.getElementById("lineChartRight").getContext("2d");
                // Destroy previous chart instance
                if (window.independenceLineChart) {
                    window.independenceLineChart.destroy();
                }
                window.independenceLineChart = new Chart(ctxLine, {
                    type: "line",
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    parser: 'MM/dd/yyyy',
                                    tooltipFormat: 'MMM dd,PPPP' // Consistent with common full date format
                                }
                            },
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Pie chart for last row
                const lastRow = rows[rows.length - 1];
                const pieLabels = headers.slice(1);
                const pieData = lastRow.slice(1).map(v => parseFloat(v));
                document.getElementById("pieTitleRight").textContent =
                    `${lastRow[0]}'s OutputPar Results`;

                // Destroy previous chart instance
                if (window.independencePieChart) {
                    window.independencePieChart.destroy();
                }
                window.independencePieChart = new Chart(document.getElementById("pieChartRight").getContext("2d"), {
                    type: "pie",
                    data: {
                        labels: pieLabels,
                        datasets: [{
                            data: pieData,
                            backgroundColor: customColors.slice(0, pieLabels.length)
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            });
    }

    // --- Event Listeners for buttons ---

    viewBothBtn.addEventListener('click', () => {
        selectionScreen.style.display = 'none'; // Hide the selection screen
        body.classList.remove('show-electoral', 'show-independence');
        body.classList.add('show-both'); // Add class to body to show both containers
        fetchElectoralData(); // Load electoral data
        fetchIndependenceData(); // Load independence data
    });

    viewElectoralBtn.addEventListener('click', () => {
        selectionScreen.style.display = 'none'; // Hide the selection screen
        body.classList.remove('show-both', 'show-independence');
        body.classList.add('show-electoral'); // Add class to body to show only electoral
        fetchElectoralData(); // Load electoral data
    });

    viewIndependenceBtn.addEventListener('click', () => {
        selectionScreen.style.display = 'none'; // Hide the selection screen
        body.classList.remove('show-both', 'show-electoral');
        body.classList.add('show-independence'); // Add class to body to show only independence
        fetchIndependenceData(); // Load independence data
    });

</script>
</body>
</html>